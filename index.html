<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>DEFIY â€” DÃ©fis & Jeux</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:sans-serif;background:#0b0b0b;color:#fff}
header{padding:25px;text-align:center;background:#111}
h1{color:#00ff99}
nav button{margin:5px;padding:12px 20px;border-radius:30px;border:none;font-weight:bold}
.green{background:#00ff99;color:#000}
.card{background:#161616;border-radius:20px;padding:20px;margin:15px auto;max-width:380px}
input{padding:10px;border-radius:10px;border:none;width:90%;margin:5px}
.hidden{display:none}
.progress{background:#333;border-radius:10px;overflow:hidden}
.bar{height:12px;background:#00ff99;width:0%}
.badge{background:#00ff99;color:black;padding:5px 10px;border-radius:10px;font-size:12px}
</style>
</head>
<body>

<header>
<h1>ğŸ”¥ DEFIY</h1>
<p id="topText">DÃ©fie tes potes. Gagne des jetons.</p>
<nav>
<button class="green" onclick="show('login')">Connexion</button>
<button class="green" onclick="show('register')">Inscription</button>
<button class="green" onclick="logout()">DÃ©connexion</button>
</nav>
</header>

<!-- AUTH -->
<div id="login" class="card hidden">
<h2>Connexion</h2>
<input id="loginEmail" placeholder="Email">
<input id="loginPass" type="password" placeholder="Mot de passe">
<button class="green" onclick="login()">Go</button>
</div>

<div id="register" class="card hidden">
<h2>Inscription</h2>
<input id="regPseudo" placeholder="Pseudo">
<input id="regEmail" placeholder="Email">
<input id="regPass" type="password" placeholder="Mot de passe">
<button class="green" onclick="register()">CrÃ©er</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

<div class="card">
<h2>ğŸª™ Jetons</h2>
<p><b><span id="tokens">0</span></b> jetons</p>
<p>Reset dans <span id="timer">--:--:--</span></p>
</div>

<div class="card">
<h2>ğŸ† DÃ©fis</h2>
<button class="green" onclick="newChallenge()">CrÃ©er un dÃ©fi (-1)</button>
<ul id="challenges"></ul>
</div>

<div class="card">
<h2>ğŸ® Jeux</h2>
<button class="green" onclick="clickGame()">Click Game</button>
<button class="green" onclick="spin()">ğŸ° Roue</button>
<p id="gameInfo"></p>
</div>

<div class="card">
<h2>ğŸ‘¤ Profil</h2>
<p>Pseudo : <span id="pseudo"></span></p>
<p>Niveau : <span id="level">1</span></p>
<div class="progress"><div class="bar" id="xpBar"></div></div>
<p><span class="badge" id="badge">DÃ©butant</span></p>
</div>

<div class="card">
<h2>ğŸ›’ Boutique</h2>
<button class="green" onclick="buy(50)">50 jetons</button>
<button class="green" onclick="buy(200)">200 jetons</button>
<button class="green" onclick="premium()">â­ Premium</button>
<p style="font-size:12px;opacity:.6">Paiement simulÃ©</p>
</div>

</div>

<script>
let user = JSON.parse(localStorage.getItem("user"));
let tokens = Number(localStorage.getItem("tokens")) || 5;
let xp = Number(localStorage.getItem("xp")) || 0;
let level = Number(localStorage.getItem("level")) || 1;
let last = Number(localStorage.getItem("last")) || Date.now();
let challenges = JSON.parse(localStorage.getItem("challenges")) || [];

function show(id){
document.querySelectorAll('.card').forEach(e=>e.classList.add('hidden'));
document.getElementById(id).classList.remove('hidden');
}

function register(){
user={pseudo:regPseudo.value,email:regEmail.value};
localStorage.setItem("user",JSON.stringify(user));
login();
}

function login(){
if(!user)return alert("Compte introuvable");
document.getElementById("dashboard").classList.remove("hidden");
pseudo.innerText=user.pseudo;
}

function logout(){localStorage.clear();location.reload();}

function newChallenge(){
if(tokens<=0)return alert("Plus de jetons");
tokens--;
challenges.push("DÃ©fi #"+(challenges.length+1));
window.open("https://forms.gle/9FCERFqSMgXZnyeq8","_blank");
save();
renderChallenges();
}

function renderChallenges(){
challengesEl=document.getElementById("challenges");
challengesEl.innerHTML="";
challenges.forEach(c=>{
let li=document.createElement("li");
li.innerText=c;
challengesEl.appendChild(li);
});
}

function clickGame(){
xp+=10;tokens++;
gameInfo.innerText="+1 jeton | +10 XP";
updateLevel();save();
}

function spin(){
let gain=Math.floor(Math.random()*5);
tokens+=gain;
gameInfo.innerText="ğŸ° +"+gain+" jetons";
save();
}

function buy(n){tokens+=n;alert("Jetons ajoutÃ©s");save();}
function premium(){alert("Premium activÃ© (fake)");}

function updateLevel(){
if(xp>=level*100){xp=0;level++;}
xpBar.style.width=(xp/(level*100)*100)+"%";
badge.innerText=level>5?"Pro":"DÃ©butant";
}

function save(){
localStorage.setItem("tokens",tokens);
localStorage.setItem("xp",xp);
localStorage.setItem("level",level);
localStorage.setItem("last",last);
localStorage.setItem("challenges",JSON.stringify(challenges));
tokensEl.innerText=tokens;
}

setInterval(()=>{
let diff=86400000-(Date.now()-last);
if(diff<=0){tokens=5;last=Date.now();}
timer.innerText=new Date(diff).toISOString().substr(11,8);
save();
},1000);

if(user)login();
renderChallenges();
</script>

</body>
</html>
